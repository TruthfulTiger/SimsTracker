<h3 class="text-primary">Summary</h3>
<div class="form-row">
    <div class="col">
        <div class="form-group mb-2">
            <label for="challengeName">Challenge name</label>
            <input type="text" id="challengeName" value="{{ trim(@challenge.challengeName) }}" name="challengeName" class="form-control"/>
        </div>
    </div>
	<div class="col">
		<div class="form-group mb-2">
			<label for="name">Household name</label>
			<input type="text" id="name" value="{{ trim(@household.name) }}" name="name" class="form-control"/>
		</div>
	</div>
</div>
<div class="form-group mb-2">
	<p>Is this also a <a href="https://web.archive.org/web/20110112123130/http://community.livejournal.com/rainbowlegacy/tag/rules" target="_blank">Rainbow Challenge?</a></p>
	<div class="custom-control custom-radio">
		<input type="radio" id="no" value="0" name="isRainbow" class="custom-control-input"
		<check if="{{ @s2legacy.isRainbow == 0}}">
			checked
		</check>
		>
		<label class="custom-control-label" for="no">No</label>
	</div>
	<div class="custom-control custom-radio">
		<input type="radio" id="yes" value="1" name="isRainbow" class="custom-control-input"
		<check if="{{ @s2legacy.isRainbow == 1}}">
			checked
		</check>
		>
		<label class="custom-control-label" for="yes">Yes</label>
	</div>
</div>
<check if="{{ @s2legacy.isRainbow == 1}}">
	<a href="{{ @BASE.'/colours/'. @challenge.id }}" target="_blank" class="btn btn-success mb-3"><i class="fa fa-plus" aria-hidden="true"></i> Set up colours</a>
</check>
<table class="table table-hover table-responsive table-sm">
	<thead class="sr-only">
	<th scope="col">Generation</th>
	<th scope="col">Founder / heir</th>
	<th scope="col">Action</th>
	</thead>
	<tbody>
	<repeat group="{{ @colours }}" value="{{ @colour }}" counter="{{ @ctr }}">
	<tr
	<check if="{{ @colour.generation == 1 }}">
		<check if="{{ @s2legacy.isRainbow == 1}}">
			class="{{ @colour.colour }}"
		</check>
	</check>>
		<check if="{{ @ctr == 1 }}">
			<th scope="row" class="p-3">Founder</th>
			<td scope="row" class="pt-2 pr-3">
				<div class="form-group">
					<label for="gen1" class="sr-only">Founder</label>
					<select class="custom-select" name="simID" id="gen1">
						<repeat group="{{ @sims }}" value="{{ @sim }}">
							<check if="{{ @sim.generation == 1 }}">
								<option value="{{ @sim.id }}"
								<check if="{{ @legacygen }}">
									<repeat group="{{ @legacygen }}" value="{{ @founder }}">
										<check if="{{ @founder.simID == @sim.id }}">
											selected="selected"
										</check>
									</repeat>
								</check>
								>
									{{ trim(@sim.firstName) }}
								</option>
							</check>
						</repeat>
					</select>
				</div>
			</td>
			<repeat group="{{ @sims }}" value="{{ @sim }}">
				<check if="{{ @sim.generation == 1 }}">
					<td scope="row" class="pt-2">
						<a id="url1"
						<check if="{{ @legacygen }}">
							<true>
								<repeat group="{{ @legacygen }}" value="{{ @founder }}">
									href="{{ @BASE }}/legacygen/update/{{@founder.id}}"
								</repeat>
							</true>
							<false>
								href=""
							</false>
						</check>
						   class="btn btn-primary text-white"><i class="fa fa-save" aria-hidden="true"></i> Save	    </a>
					</td>
				</check>
			</repeat>
			</tr>
		</check>

	<tr id="gen2heir"
	<check if="{{ @colour.generation == 2 }}">
		<check if="{{ @s2legacy.isRainbow == 1}}">
			class="{{ @colour.colour }}"
		</check>
	</check>>
	<check if="{{ @ctr == 2 }}">
	<th scope="row" class="p-3">2nd generation heir/ess</th>
	<td scope="row" class="pt-2 pr-3">
		<div class="form-group">
			<label for="gen2" class="sr-only">Heir/ess</label>
			<select class="custom-select" name="simID" id="gen2">
				<repeat group="{{ @sims }}" value="{{ @sim }}">
					<check if="{{ @sim.generation == 2 }}">
						<option value="{{ @sim.id }}"
						<check if="{{ @legacygen }}">
						<repeat group="{{ @legacygen }}" value="{{ @heir }}">
							<check if="{{ @heir.simID == @sim.id }}">
								selected="selected"
							</check>
						</repeat>
						</check>
						>
							{{ trim(@sim.firstName) }}
						</option>
					</check>
				</repeat>
			</select>
		</div>
	</td>
		<td scope="row" class="pt-2">
			<a id="url2"
			<check if="{{ @legacygen }}">
				<true>
					<repeat group="{{ @legacygen }}" value="{{ @heir }}" counter="{{ @ctr1 }}">
						<check if="{{ @ctr1 == 2 }}">
							href="{{ @BASE }}/legacygen/update/{{@heir.id}}"
						</check>
					</repeat>
				</true>
				<false>
					href=""
				</false>
			</check> class="btn btn-primary text-white"><i class="fa fa-save" aria-hidden="true"></i> Save</a>
		</td>
	</tr>
	</check>

		<tr id="gen3heir"
		<check if="{{ @colour.generation == 3 }}">
			<check if="{{ @s2legacy.isRainbow == 1}}">
				class="{{ @colour.colour }}"
			</check>
		</check>>
		<check if="{{ @ctr == 3 }}">
			<th scope="row" class="p-3">3rd generation heir/ess</th>
			<td scope="row" class="pt-2 pr-3">
				<div class="form-group">
					<label for="gen3" class="sr-only">Heir/ess</label>
					<select class="custom-select" name="simID" id="gen3">
						<repeat group="{{ @sims }}" value="{{ @sim }}">
							<check if="{{ @sim.generation == 3 }}">
								<option value="{{ @sim.id }}"
								<check if="{{ @legacygen }}">
									<repeat group="{{ @legacygen }}" value="{{ @heir }}">
										<check if="{{ @heir.simID == @sim.id }}">
											selected="selected"
										</check>
									</repeat>
								</check>
								>
								{{ trim(@sim.firstName) }}
								</option>
							</check>
						</repeat>
					</select>
				</div>
			</td>
			<td scope="row" class="pt-2">
				<a id="url3"
				<check if="{{ @legacygen }}">
					<true>
						<repeat group="{{ @legacygen }}" value="{{ @heir }}" counter="{{ @ctr1 }}">
							<check if="{{ @ctr1 == 3 }}">
								href="{{ @BASE }}/legacygen/update/{{@heir.id}}"
							</check>
						</repeat>
					</true>
					<false>
						href=""
					</false>
				</check> class="btn btn-primary text-white"><i class="fa fa-save" aria-hidden="true"></i> Save</a>
			</td>
			</tr>
		</check>

		<tr id="gen4heir"
		<check if="{{ @colour.generation == 4 }}">
			<check if="{{ @s2legacy.isRainbow == 1}}">
				class="{{ @colour.colour }}"
			</check>
		</check>>
		<check if="{{ @ctr == 4 }}">
			<th scope="row" class="p-3">4th generation heir/ess</th>
			<td scope="row" class="pt-2 pr-3">
				<div class="form-group">
					<label for="gen4" class="sr-only">Heir/ess</label>
					<select class="custom-select" name="simID" id="gen4">
						<repeat group="{{ @sims }}" value="{{ @sim }}">
							<check if="{{ @sim.generation == 4 }}">
								<option value="{{ @sim.id }}"
								<check if="{{ @legacygen }}">
									<repeat group="{{ @legacygen }}" value="{{ @heir }}">
										<check if="{{ @heir.simID == @sim.id }}">
											selected="selected"
										</check>
									</repeat>
								</check>
								>
								{{ trim(@sim.firstName) }}
								</option>
							</check>
						</repeat>
					</select>
				</div>
			</td>
			<td scope="row" class="pt-2">
				<a id="url4"
				<check if="{{ @legacygen }}">
					<true>
						<repeat group="{{ @legacygen }}" value="{{ @heir }}" counter="{{ @ctr1 }}">
							<check if="{{ @ctr1 == 4 }}">
								href="{{ @BASE }}/legacygen/update/{{@heir.id}}"
							</check>
						</repeat>
					</true>
					<false>
						href=""
					</false>
				</check> class="btn btn-primary text-white"><i class="fa fa-save" aria-hidden="true"></i> Save</a>
			</td>
			</tr>
		</check>

		<tr id="gen5heir"
		<check if="{{ @colour.generation == 5 }}">
			<check if="{{ @s2legacy.isRainbow == 1}}">
				class="{{ @colour.colour }}"
			</check>
		</check>>
		<check if="{{ @ctr == 5 }}">
			<th scope="row" class="p-3">5th generation heir/ess</th>
			<td scope="row" class="pt-2 pr-3">
				<div class="form-group">
					<label for="gen5" class="sr-only">Heir/ess</label>
					<select class="custom-select" name="simID" id="gen5">
						<repeat group="{{ @sims }}" value="{{ @sim }}">
							<check if="{{ @sim.generation == 5 }}">
								<option value="{{ @sim.id }}"
								<check if="{{ @legacygen }}">
									<repeat group="{{ @legacygen }}" value="{{ @heir }}">
										<check if="{{ @heir.simID == @sim.id }}">
											selected="selected"
										</check>
									</repeat>
								</check>
								>
								{{ trim(@sim.firstName) }}
								</option>
							</check>
						</repeat>
					</select>
				</div>
			</td>
			<td scope="row" class="pt-2">
				<a id="url5"
				<check if="{{ @legacygen }}">
					<true>
						<repeat group="{{ @legacygen }}" value="{{ @heir }}" counter="{{ @ctr1 }}">
							<check if="{{ @ctr1 == 5 }}">
								href="{{ @BASE }}/legacygen/update/{{@heir.id}}"
							</check>
						</repeat>
					</true>
					<false>
						href=""
					</false>
				</check> class="btn btn-primary text-white"><i class="fa fa-save" aria-hidden="true"></i> Save</a>
			</td>
			</tr>
		</check>

		<tr id="gen6heir"
		<check if="{{ @colour.generation == 6 }}">
			<check if="{{ @s2legacy.isRainbow == 1}}">
				class="{{ @colour.colour }}"
			</check>
		</check>>
		<check if="{{ @ctr == 6 }}">
			<th scope="row" class="p-3">6th generation heir/ess</th>
			<td scope="row" class="pt-2 pr-3">
				<div class="form-group">
					<label for="gen6" class="sr-only">Heir/ess</label>
					<select class="custom-select" name="simID" id="gen6">
						<repeat group="{{ @sims }}" value="{{ @sim }}">
							<check if="{{ @sim.generation == 6 }}">
								<option value="{{ @sim.id }}"
								<check if="{{ @legacygen }}">
									<repeat group="{{ @legacygen }}" value="{{ @heir }}">
										<check if="{{ @heir.simID == @sim.id }}">
											selected="selected"
										</check>
									</repeat>
								</check>
								>
								{{ trim(@sim.firstName) }}
								</option>
							</check>
						</repeat>
					</select>
				</div>
			</td>
			<td scope="row" class="pt-2">
				<a id="url6"
				<check if="{{ @legacygen }}">
					<true>
						<repeat group="{{ @legacygen }}" value="{{ @heir }}" counter="{{ @ctr1 }}">
							<check if="{{ @ctr1 == 6 }}">
								href="{{ @BASE }}/legacygen/update/{{@heir.id}}"
							</check>
						</repeat>
					</true>
					<false>
						href=""
					</false>
				</check> class="btn btn-primary text-white"><i class="fa fa-save" aria-hidden="true"></i> Save</a>
			</td>
			</tr>
		</check>

		<tr id="gen7heir"
		<check if="{{ @colour.generation == 7 }}">
			<check if="{{ @s2legacy.isRainbow == 1}}">
				class="{{ @colour.colour }}"
			</check>
		</check>>
		<check if="{{ @ctr == 7 }}">
			<th scope="row" class="p-3">7th generation heir/ess</th>
			<td scope="row" class="pt-2 pr-3">
				<div class="form-group">
					<label for="gen7" class="sr-only">Heir/ess</label>
					<select class="custom-select" name="simID" id="gen7">
						<repeat group="{{ @sims }}" value="{{ @sim }}">
							<check if="{{ @sim.generation == 7 }}">
								<option value="{{ @sim.id }}"
								<check if="{{ @legacygen }}">
									<repeat group="{{ @legacygen }}" value="{{ @heir }}">
										<check if="{{ @heir.simID == @sim.id }}">
											selected="selected"
										</check>
									</repeat>
								</check>
								>
								{{ trim(@sim.firstName) }}
								</option>
							</check>
						</repeat>
					</select>
				</div>
			</td>
			<td scope="row" class="pt-2">
				<a id="url7"
				<check if="{{ @legacygen }}">
					<true>
						<repeat group="{{ @legacygen }}" value="{{ @heir }}" counter="{{ @ctr1 }}">
							<check if="{{ @ctr1 == 7 }}">
								href="{{ @BASE }}/legacygen/update/{{@heir.id}}"
							</check>
						</repeat>
					</true>
					<false>
						href=""
					</false>
				</check> class="btn btn-primary text-white"><i class="fa fa-save" aria-hidden="true"></i> Save</a>
			</td>
			</tr>
		</check>

		<tr id="gen8heir"
		<check if="{{ @colour.generation == 8 }}">
			<check if="{{ @s2legacy.isRainbow == 1}}">
				class="{{ @colour.colour }}"
			</check>
		</check>>
		<check if="{{ @ctr == 8 }}">
			<th scope="row" class="p-3">8th generation heir/ess</th>
			<td scope="row" class="pt-2 pr-3">
				<div class="form-group">
					<label for="gen8" class="sr-only">Heir/ess</label>
					<select class="custom-select" name="simID" id="gen8">
						<repeat group="{{ @sims }}" value="{{ @sim }}">
							<check if="{{ @sim.generation == 8 }}">
								<option value="{{ @sim.id }}"
								<check if="{{ @legacygen }}">
									<repeat group="{{ @legacygen }}" value="{{ @heir }}">
										<check if="{{ @heir.simID == @sim.id }}">
											selected="selected"
										</check>
									</repeat>
								</check>
								>
								{{ trim(@sim.firstName) }}
								</option>
							</check>
						</repeat>
					</select>
				</div>
			</td>
			<td scope="row" class="pt-2">
				<a id="url8"
				<check if="{{ @legacygen }}">
					<true>
						<repeat group="{{ @legacygen }}" value="{{ @heir }}" counter="{{ @ctr1 }}">
							<check if="{{ @ctr1 == 8 }}">
								href="{{ @BASE }}/legacygen/update/{{@heir.id}}"
							</check>
						</repeat>
					</true>
					<false>
						href=""
					</false>
				</check> class="btn btn-primary text-white"><i class="fa fa-save" aria-hidden="true"></i> Save</a>
			</td>
			</tr>
		</check>

		<tr id="gen9heir"
		<check if="{{ @colour.generation == 9 }}">
			<check if="{{ @s2legacy.isRainbow == 1}}">
				class="{{ @colour.colour }}"
			</check>
		</check>>
		<check if="{{ @ctr == 9 }}">
			<th scope="row" class="p-3">9th generation heir/ess</th>
			<td scope="row" class="pt-2 pr-3">
				<div class="form-group">
					<label for="gen9" class="sr-only">Heir/ess</label>
					<select class="custom-select" name="simID" id="gen9">
						<repeat group="{{ @sims }}" value="{{ @sim }}">
							<check if="{{ @sim.generation == 9 }}">
								<option value="{{ @sim.id }}"
								<check if="{{ @legacygen }}">
									<repeat group="{{ @legacygen }}" value="{{ @heir }}">
										<check if="{{ @heir.simID == @sim.id }}">
											selected="selected"
										</check>
									</repeat>
								</check>
								>
								{{ trim(@sim.firstName) }}
								</option>
							</check>
						</repeat>
					</select>
				</div>
			</td>
			<td scope="row" class="pt-2">
				<a id="url9"
				<check if="{{ @legacygen }}">
					<true>
						<repeat group="{{ @legacygen }}" value="{{ @heir }}" counter="{{ @ctr1 }}">
							<check if="{{ @ctr1 == 9 }}">
								href="{{ @BASE }}/legacygen/update/{{@heir.id}}"
							</check>
						</repeat>
					</true>
					<false>
						href=""
					</false>
				</check> class="btn btn-primary text-white"><i class="fa fa-save" aria-hidden="true"></i> Save</a>
			</td>
			</tr>
		</check>

		<tr id="gen10heir"
		<check if="{{ @colour.generation == 10 }}">
			<check if="{{ @s2legacy.isRainbow == 1}}">
				class="{{ @colour.colour }}"
			</check>
		</check>>
		<check if="{{ @ctr == 10 }}">
			<th scope="row" class="p-3">10th generation heir/ess</th>
			<td scope="row" class="pt-2 pr-3">
				<div class="form-group">
					<label for="gen10" class="sr-only">Heir/ess</label>
					<select class="custom-select" name="simID" id="gen10">
						<repeat group="{{ @sims }}" value="{{ @sim }}">
							<check if="{{ @sim.generation == 10 }}">
								<option value="{{ @sim.id }}"
								<check if="{{ @legacygen }}">
									<repeat group="{{ @legacygen }}" value="{{ @heir }}">
										<check if="{{ @heir.simID == @sim.id }}">
											selected="selected"
										</check>
									</repeat>
								</check>
								>
								{{ trim(@sim.firstName) }}
								</option>
							</check>
						</repeat>
					</select>
				</div>
			</td>
			<td scope="row" class="pt-2">
				<a id="url10"
				<check if="{{ @legacygen }}">
					<true>
						<repeat group="{{ @legacygen }}" value="{{ @heir }}" counter="{{ @ctr1 }}">
							<check if="{{ @ctr1 == 10 }}">
								href="{{ @BASE }}/legacygen/update/{{@heir.id}}"
							</check>
						</repeat>
					</true>
					<false>
						href=""
					</false>
				</check> class="btn btn-primary text-white"><i class="fa fa-save" aria-hidden="true"></i> Save</a>
			</td>
			</tr>
		</check>

	</repeat>
	</tbody>
</table>

<input type="hidden" name="grandtotal" id="gt" value="{{ trim(@s2legacy.grandtotal) }}">
<p class="lead mt-3"><b>Grand total: <output id="grandtotal" for="gt"><span
    <check if="{{ @s2legacy.grandtotal }} == 0">class="badge badge-primary"</check>
    <check if="{{ @s2legacy.grandtotal }} > 0">class="badge badge-success"</check>
    <check if="{{ @s2legacy.grandtotal }} < 0">class="badge badge-danger"</check>>
    {{ trim(@s2legacy.grandtotal) }}
	</span></output></b></p>

<script>
	let text = '';
	let a_href = '';
	let s = 0;
	$(function () {
		getGen(1);
		getGen(2);
		getGen(3);
		getGen(4);
		getGen(5);
		getGen(6);
		getGen(7);
		getGen(8);
		getGen(9);
		getGen(10);

		$("#gen1").change(function(){
			getGen(1);
		});
		$("#gen2").change(function(){
			getGen(2);
		});
		$("#gen3").change(function(){
			getGen(3);
		});
		$("#gen4").change(function(){
			getGen(4);
		});
		$("#gen5").change(function(){
			getGen(5);
		});
		$("#gen6").change(function(){
			getGen(6);
		});
		$("#gen7").change(function(){
			getGen(7);
		});
		$("#gen8").change(function(){
			getGen(8);
		});
		$("#gen9").change(function(){
			getGen(9);
		});
		$("#gen10").change(function(){
			getGen(10);
		});
	});

	function getGen(v) {
		text = '';
		a_href = '';
		s = $("#gen"+v).val();
		if (s >=1) {
			a_href = $("#url"+v).attr('href');
			text = a_href + '/{{@SESSION.user[2]}}/'+v+'/{{@SESSION.challenge }}/';
		} else {
			text = '{{ @BASE }}/legacygen/create/{{@SESSION.user[2]}}/'+v+'/{{@SESSION.challenge }}/';
		}
		let value = $('#gen'+v+' option:selected').val();
		$("#url"+v).on('click', function(e) {
			$(this).attr('href', text + value);
		});
	}

	function gtChange() {
		let lt = $("#lt").val();
		let mt = $("#mt").val();
		let ft = $("#ft").val();
		let wt = $("#wt").val();
		let gvt = $("#gvt").val();
		let ght = $("#ght").val();
		let bt = $("#bt").val();
		let pt = $("#pt").val();
		let st = $("#st").val();
		let bvt = $("#bvt").val();
		let ftt = $("#ftt").val();
		let ct = $("#ct").val();
		let mat = $("#mat").val();
		let ht = $("#ht").val();
		let ot = $("#ot").val();

		let result = parseFloat(lt) + parseFloat(mt) + parseFloat(ft) + parseFloat(wt) + parseFloat(gvt) + parseFloat(ght) + parseFloat(bt) + parseFloat(pt) + parseFloat(st) + parseFloat(bvt) + parseFloat(ftt) + parseFloat(ct) + parseFloat(mat) + parseFloat(ht) + parseFloat(ot);

		$("#grandtotal").val(result);
		$("#gt").val(result);

		if (result == 0) {
			$('#grandtotal').removeClass('badge badge-danger');
			$('#grandtotal').removeClass('badge badge-success');
			$('#grandtotal').addClass('badge badge-primary');
		}


		if (result > 0) {
			$('#grandtotal').removeClass('badge badge-danger');
			$('#grandtotal').removeClass('badge badge-primary');
			$('#grandtotal').addClass('badge badge-success');
		}

		if (result < 0) {
			$('#grandtotal').removeClass('badge badge-primary');
			$('#grandtotal').removeClass('badge badge-success');
			$('#grandtotal').addClass('badge badge-danger');
		}
	}
</script>